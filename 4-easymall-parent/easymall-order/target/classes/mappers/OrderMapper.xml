<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.tedu.order.mapper.OrderMapper">
    <insert id="insertOrder">
        insert into t_order (order_id, order_money, order_receiverinfo, order_paystate, order_time, user_id)
        VALUES (#{orderId},#{orderMoney},#{orderReceiverinfo},#{orderPaystate},#{orderTime},#{userId});
        <foreach collection="orderItems" item="oi">
            insert into t_order_item (order_id, product_id, num, product_image, product_name, product_price)
            VALUES (#{orderId},#{oi.productId},#{oi.num},#{oi.productImage},#{oi.productName},#{oi.productPrice});
        </foreach>
    </insert>
    <select id="selectOrderByUserid" resultMap="ORDERM">
        select * from t_order o inner join t_order_item oi on o.order_id=oi.order_id
        where user_id=#{userId};
    </select>
    <resultMap id="ORDERM" type="common.pojo.Order">
        <id property="orderId" column="order_id"></id>
        <result property="orderMoney" column="order_money"></result>
        <result property="orderReceiverinfo" column="order_receiverinfo"></result>
        <result property="orderPaystate" column="order_paystate"></result>
        <result property="orderTime" column="order_time"></result>
        <result property="userId" column="user_id"></result>
        <collection property="orderItems" javaType="ArrayList" ofType="common.pojo.OrderItem">
            <id property="id" column="id"></id>
            <result property="orderId" column="order_id"></result>
            <result property="productId" column="product_id"></result>
            <result property="num" column="num"></result>
            <result property="productImage" column="product_image"></result>
            <result property="productName" column="product_name"></result>
            <result property="productPrice" column="product_price"></result>
        </collection>
    </resultMap>
    <delete id="delectOrderByOrderid">
        delete from t_order where order_id=#{orderId};
        delete from t_order_item where order_id=#{orderId};
    </delete>
</mapper>










